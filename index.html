<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="bundle.js"></script>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/new-age.min.css" />

    <title>OpenBazaar Web Relay Demo</title>
  </head>
  <body id="page-top">

    <header class="masthead">
      <div class="container h-100">
        <div class="row h-100">
          <div class="col-lg-7 my-auto">
            <div class="header-content mx-auto">
              <h1 class="mb-5">OpenBazaar Web Relay Demo</h1>
              <p>Send a chat message to anyone on OpenBazaar from the web!</p>
            </div>
          </div>
          <div class="col-lg-5 my-auto">
            <div class="device-container">
              <div class="device-mockup iphone6_plus portrait white">
                <div class="device">
                  <div class="screen">
                    <table class="table">
                      <tr>
                        <td>Subscription Key:</td>
                        <td><span id="subkey"></span></td>
                      </tr>
                      <tr>
                        <td>Peer ID:</td>
                        <td><span id="peerid"></span></td>
                      </tr>
                      <tr>
                        <td>Mnemonic:</td>
                        <td><span id="mnemonic"></span></td>
                      </tr>
                    </table>
                  </div>
                  <div class="button">
                    <!-- You can hook the "home button" to some JavaScript events or just remove it -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="container">


      <form action="javascript:void(0);" onsubmit="sendMessage(this.peerID.value, this.message.value);">
        <h2>Chat Room</h2>

        <div class="form-group">
          <input type="text" name="peerID" class="form-control" value="" size="100" placeholder="Enter Recipient Peer ID"/>
        </div>

        <div class="form-group">
        <div id="incoming_messages" style="border:1px solid #999;background-color:#efefef;height:300px;width:100%;overflow-y:scroll;"></div>
      </div>


        <div class="form-group">
          <input id="message" type="text" name="message" class="form-control"></textarea>
        </div>
        <div class="form-group">
          <input type="submit" class="btn btn-default" value="Send Message"/>
        </div>


      </form>



    </div>

    <script>

    decryptMessage();

    var updatePeerInfo = (peer) => {
      //peer.peerid = "QmNU2H1S1gNf782s9gvFFV9jUKBSy7uuWU8QtAA2N3bhFZ";
      var subkey = getSubKey(peer.peerid);
      document.getElementById('subkey').innerHTML = subkey;
      document.getElementById('peerid').innerHTML = peer.peerid;
      document.getElementById('mnemonic').innerHTML = peer.mnemonic;
    }

    generatePeerID(updatePeerInfo);

    function sendMsg(peerid, msg) {
      sendMessage('QmNU2H1S1gNf782s9gvFFV9jUKBSy7uuWU8QtAA2N3bhFZ', 'test');
    }

    </script>


  </body>

</html>
